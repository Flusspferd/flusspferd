# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0


name                flusspferd
version             git
categories          devel
maintainers         flusspferd.org:team
description         Flusspferd
long_description    Flusspferd provides Javascript bindings for C++.
homepage            http://flusspferd.org/
platforms           darwin

fetch.type          git
git.url             git://github.com/ruediger/flusspferd.git

depends_build       port:python25 \
                    port:git-core

depends_lib         port:spidermonkey \
                    port:boost
default_variants    test

configure.args      --with-spidermonkey=${prefix} --prefix=${prefix}

variant test description { Build Unit Tests } {
    configure.args-append --enable-tests
    test {
        system "cd ${worksrcpath} && ./util/run_tests.sh"
    }
}

variant xml description { Add XML support } {
    depends_lib-append port:libxml2
}

variant curl description { Add Curl support } {
    depends_lib-append port:curl
}

variant sqlite description { Add SQLite support } {
    depends_lib-append port:sqlite3
}

configure {
    system "cd ${worksrcpath} && PYTHON=python2.5 ./configure ${configure.args}"
}

pre-build {
    system \
"cd ${worksrcpath} && echo -e \"PYTHON := python2.5\nNOTNOISY := 1\" > .localsettings.mak"
}

destroot {
    system \
"cd ${worksrcpath} &&  python2.5 ./waf install --destdir=\"${destroot}\""
}
